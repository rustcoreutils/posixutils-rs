# C99 Compliance TODO

This document tracks remaining C99 compliance items for pcc. Items are
organized by priority and complexity.

## Table of Contents

- [Medium Priority](#medium-priority)
  - [`[*]` in Function Prototypes](#-in-function-prototypes)
- [Low Priority](#low-priority)
  - [Inline Function Optimization](#inline-function-optimization)
  - [FP Register Save for Variadic Functions](#fp-register-save-for-variadic-functions)

---

## Medium Priority

### `[*]` in Function Prototypes

**Status**: NOT IMPLEMENTED

**C99 Reference**: 6.7.5.2

**Description**: In function prototypes (not definitions), `[*]` indicates a VLA of unspecified size:
```c
void f(int n, int arr[*]);  // VLA parameter with unspecified size
```

**Current Behavior**: Parse error: "unexpected token in expression"

**Implementation Notes**:
- Only valid in function prototype declarations (not definitions)
- Indicates that the parameter is a VLA
- The actual size is determined by another parameter

**Complexity**: Low

---

## Low Priority

These items are implemented but incomplete or have known limitations that rarely affect real code.

### Inline Function Optimization

**Status**: PARTIAL (semantics correct, optimization missing)

**C99 Reference**: 6.7.4

**Description**: The `inline` keyword is a hint for inlining.

**Current Behavior**:
- `inline` keyword is recognized and parsed
- C99 inline semantics are correctly enforced (restrictions on static references)
- Functions are NOT actually inlined

**Location**:
- `cc/README.md` line 84
- `cc/ir/linearize.rs` lines 725-739 (semantic checks)

**Impact**: Performance only; no correctness issues.

**Complexity**: High (requires inlining pass in optimizer)

---

### FP Register Save for Variadic Functions

**Status**: PARTIAL

**C99 Reference**: ABI-dependent

**Description**: On x86-64 SysV ABI, variadic functions should save XMM registers for floating-point variadic arguments.

**Current Behavior**:
- GP registers are saved correctly
- XMM registers are not saved
- `va_arg(ap, double)` in user-defined variadic functions won't work

**Location**: `cc/doc/TODO.md` lines 49-69

**Impact**: Low. libc variadic functions work correctly. Only affects user-defined variadic functions accepting float/double arguments.

**Complexity**: Medium

---

## Summary Table

| Feature | Status | Complexity | Priority |
|---------|--------|------------|----------|
| `[*]` in prototypes | Not implemented | Low | Medium |
| Inline optimization | Partial | High | Low |
| FP variadic save | Partial | Medium | Low |

---

## References

- [ISO/IEC 9899:1999 (C99)](https://www.open-std.org/jtc1/sc22/wg14/www/docs/n1256.pdf)
- [C99 Rationale](https://www.open-std.org/jtc1/sc22/wg14/www/C99RationaleV5.10.pdf)
- [cppreference C99 features](https://en.cppreference.com/w/c/99)
